---
const { pathname } = Astro.url;

// Determinar si estamos en una página específica o en home
const isAboutPage = pathname.includes('/about');
const isContactPage = pathname.includes('/contact');
const isHomePage = pathname === '/';

// Configurar las URLs según la página actual
const navItems = [
  { 
    title: "Inicio", 
    url: isAboutPage || isContactPage ? "/" : "#inicio",
    label: "inicio" 
  },
  { 
    title: "Servicios", 
    url: isAboutPage || isContactPage ? "/#servicios" : "#servicios",
    label: "servicios" 
  },
  { 
    title: "Galería", 
    url: isAboutPage || isContactPage ? "/#galeria" : "#galeria",
    label: "galeria" 
  },
  { 
    title: "Nosotros", 
    url: "/about",
    label: "nosotros" 
  },
  { 
    title: "Contacto", 
    url: "/contact",
    label: "contacto" 
  }
];
---

<header class="fixed top-0 left-0 right-0 z-50" style="background: transparent !important;">
  <div class="w-full max-w-full px-4 sm:px-4 py-3 sm:py-4 box-border" style="background: transparent !important;">
    <nav 
      id="main-nav" 
      class="nav-transparent flex justify-between items-center gap-3 mx-auto rounded-2xl sm:rounded-full px-3 sm:px-6 py-2.5 sm:py-3 box-border"
      style="background: rgba(15, 23, 42, 0.5) !important; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); max-width: 100%;"
    >
      <!-- Logo -->
    <a 
      href={isAboutPage || isContactPage ? "/" : "#inicio"} 
      class="flex items-center group hover:opacity-90 transition-opacity duration-300 flex-shrink-0 min-w-0"
    >
      <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-primary-600 to-primary-400 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
        <span class="text-white font-bold text-base sm:text-xl">EP</span>
      </div>
      <span class="ml-2 text-sm sm:text-base md:text-lg font-serif font-bold text-white whitespace-nowrap hidden xs:inline">
        Eventos Premium
      </span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden lg:flex items-center space-x-1 flex-shrink-0">
      {navItems.map((link) => (
        <a
          class="nav-link relative block px-4 py-2 text-sm font-medium text-gray-200 hover:text-primary-300 transition-colors duration-300"
          aria-label={link.label}
          href={link.url}
        >
          {link.title}
        </a>
      ))}
      <a
        href="/contact"
        class="ml-4 inline-flex items-center px-6 py-2.5 text-sm font-semibold text-white bg-primary-600 hover:bg-primary-700 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
      >
        Solicitar Presupuesto
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button 
      id="mobile-menu-button"
      class="lg:hidden w-9 h-9 sm:w-10 sm:h-10 flex flex-col justify-center items-center space-y-1.5 group relative z-50 flex-shrink-0"
      aria-label="Toggle mobile menu"
    >
      <span class="hamburger-line w-5 sm:w-6 h-0.5 bg-gray-200 transition-all duration-300 group-hover:bg-primary-300"></span>
      <span class="hamburger-line w-5 sm:w-6 h-0.5 bg-gray-200 transition-all duration-300 group-hover:bg-primary-300"></span>
      <span class="hamburger-line w-5 sm:w-6 h-0.5 bg-gray-200 transition-all duration-300 group-hover:bg-primary-300"></span>
    </button>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div 
    id="mobile-menu-overlay" 
    class="fixed inset-0 bg-black/60 backdrop-blur-sm opacity-0 invisible transition-all duration-300 lg:hidden z-40"
  ></div>

  <!-- Mobile Menu -->
  <div 
    id="mobile-menu" 
    class="fixed top-0 right-0 h-full w-full max-w-sm bg-dark-900/98 backdrop-blur-xl border-l border-gray-700/50 transform translate-x-full transition-transform duration-300 ease-in-out lg:hidden z-50 overflow-y-auto"
  >
    <!-- Mobile Menu Header -->
    <div class="flex justify-between items-center p-6 border-b border-gray-700/50">
      <a 
        href={isAboutPage || isContactPage ? "/" : "#inicio"} 
        class="flex items-center hover:opacity-80 transition-opacity duration-300"
      >
        <div class="w-8 h-8 bg-gradient-to-br from-primary-600 to-primary-400 rounded-lg flex items-center justify-center">
          <span class="text-white font-bold text-lg">EP</span>
        </div>
        <span class="ml-2 text-lg font-serif font-bold text-white">Eventos Premium</span>
      </a>
      <button 
        id="mobile-menu-close"
        class="w-10 h-10 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-all duration-300"
        aria-label="Close mobile menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation Links -->
    <nav class="p-6">
      <ul class="space-y-2">
        {navItems.map((link) => (
          <li>
            <a
              href={link.url}
              class="mobile-nav-link block py-3 px-4 text-gray-200 hover:text-primary-300 hover:bg-primary-600/10 rounded-lg transition-all duration-300 font-medium"
              aria-label={link.label}
            >
              {link.title}
            </a>
          </li>
        ))}
      </ul>

      <!-- Mobile CTA -->
      <div class="mt-8 pt-6 border-t border-gray-700/50">
        <a 
          href="/contact"
          class="mobile-nav-link block w-full bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-700 hover:to-primary-600 text-white text-center py-3.5 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg"
        >
          Solicitar Presupuesto
        </a>
        
        <!-- Contact Info -->
        <div class="mt-6 space-y-3 text-sm text-gray-400">
          <a href="tel:+34900123456" class="flex items-center space-x-2 hover:text-primary-300 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
            <span>+34 900 123 456</span>
          </a>
          <a href="mailto:info@eventospremium.com" class="flex items-center space-x-2 hover:text-primary-300 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            <span>info@eventospremium.com</span>
          </a>
        </div>
      </div>
    </nav>
  </div>
</header>

<script>
  // Ejecutar inmediatamente sin esperar DOMContentLoaded
  (function() {
    const mainNav = document.getElementById('main-nav');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link') as NodeListOf<HTMLElement>;
    const hamburgerLines = document.querySelectorAll('.hamburger-line') as NodeListOf<HTMLElement>;

    // Manejar el cambio de estilo del navbar al hacer scroll
    
    function updateNavbar() {
      const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
      
      if (currentScroll > 50) {
        if (mainNav) {
          mainNav.style.background = 'rgba(15, 23, 42, 0.98)';
          mainNav.style.backdropFilter = 'blur(20px)';
          (mainNav.style as any).webkitBackdropFilter = 'blur(20px)';
          mainNav.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.3)';
          mainNav.style.border = '1px solid rgba(255, 255, 255, 0.1)';
        }
      } else {
        if (mainNav) {
          mainNav.style.background = 'rgba(15, 23, 42, 0.5)';
          mainNav.style.backdropFilter = 'blur(12px)';
          (mainNav.style as any).webkitBackdropFilter = 'blur(12px)';
          mainNav.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
          mainNav.style.border = '1px solid rgba(255, 255, 255, 0.1)';
        }
      }
    }

    // Ejecutar al cargar y al hacer scroll
    updateNavbar();
    window.addEventListener('scroll', updateNavbar, { passive: true });

    // Function to open mobile menu
    function openMobileMenu() {
      mobileMenu?.classList.remove('translate-x-full');
      mobileMenuOverlay?.classList.remove('opacity-0', 'invisible');
      document.body.style.overflow = 'hidden';
      
      // Animate hamburger to X
      if (hamburgerLines.length >= 3) {
        hamburgerLines[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
        hamburgerLines[1].style.opacity = '0';
        hamburgerLines[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
      }
      
      // Animate menu items
      mobileNavLinks.forEach((link, index) => {
        setTimeout(() => {
          link.style.opacity = '1';
          link.style.transform = 'translateX(0)';
        }, index * 50);
      });
    }

    // Function to close mobile menu
    function closeMobileMenu() {
      mobileMenu?.classList.add('translate-x-full');
      mobileMenuOverlay?.classList.add('opacity-0', 'invisible');
      document.body.style.overflow = '';
      
      // Reset hamburger
      if (hamburgerLines.length >= 3) {
        hamburgerLines[0].style.transform = '';
        hamburgerLines[1].style.opacity = '1';
        hamburgerLines[2].style.transform = '';
      }
      
      // Reset menu items animation
      mobileNavLinks.forEach((link: HTMLElement) => {
        link.style.opacity = '0';
        link.style.transform = 'translateX(20px)';
      });
    }

    // Event listeners
    mobileMenuButton?.addEventListener('click', openMobileMenu);
    mobileMenuClose?.addEventListener('click', closeMobileMenu);
    mobileMenuOverlay?.addEventListener('click', closeMobileMenu);

    // Close menu when clicking on nav links
    mobileNavLinks.forEach((link: HTMLElement) => {
      link.addEventListener('click', () => {
        setTimeout(closeMobileMenu, 300);
      });
    });

    // Close menu when pressing Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeMobileMenu();
      }
    });

    // Initialize mobile nav links animation state
    mobileNavLinks.forEach((link: HTMLElement) => {
      link.style.opacity = '0';
      link.style.transform = 'translateX(20px)';
      link.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    });

    // Active section highlighting for homepage
    if (window.location.pathname === '/') {
      const sections = document.querySelectorAll("section");
      const navItems = document.querySelectorAll(".nav-link");

      const callback = (entries: IntersectionObserverEntry[]) => {
        entries.forEach((entry: IntersectionObserverEntry) => {
          if (entry.isIntersecting) {
            navItems.forEach((item) => {
              const href = item.getAttribute("href");
              const sectionId = '#' + entry.target.id;
              if (href === sectionId) {
                item.classList.add("text-primary-300");
              } else {
                item.classList.remove("text-primary-300");
              }
            });
          }
        });
      };

      const observer = new IntersectionObserver(callback, {
        root: null,
        rootMargin: "0px",
        threshold: 0.3,
      });

      sections.forEach((section) => {
        if (section.id) {
          observer.observe(section);
        }
      });
    }
  })();
</script>

<style>
  /* Asegurar que el header y todos sus hijos sean completamente transparentes */
  header {
    background: transparent !important;
    background-color: transparent !important;
  }
  
  header > div {
    max-width: 100vw !important;
    background: transparent !important;
    background-color: transparent !important;
  }
  
  header * {
    box-sizing: border-box;
  }

  /* Estado inicial del navbar - Transparente con poco blur */
  nav {
    transition: all 0.3s ease-in-out;
    isolation: isolate;
    position: relative;
    box-sizing: border-box;
    max-width: min(80rem, 100%) !important;
    width: 100%;
    min-width: 0;
  }

  /* Ocultar texto del logo en pantallas muy pequeñas */
  @media (max-width: 420px) {
    .xs\:inline {
      display: none !important;
    }
  }
  
  @media (min-width: 421px) {
    .xs\:inline {
      display: inline !important;
    }
  }

  nav.nav-transparent {
    background: rgba(15, 23, 42, 0.5) !important;
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  /* Estado del navbar al hacer scroll - Sólido con blur completo */
  nav.nav-solid {
    background: rgba(15, 23, 42, 0.98) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Hamburger animation */
  .hamburger-line {
    transition: all 0.3s ease;
    transform-origin: center;
  }

  /* Mobile menu animations */
  .mobile-nav-link {
    opacity: 0;
    transform: translateX(20px);
    transition: opacity 0.3s ease, transform 0.3s ease, color 0.3s ease, background-color 0.3s ease;
  }

  /* Prevent body scroll when mobile menu is open */
  body:has(#mobile-menu:not(.translate-x-full)) {
    overflow: hidden;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Responsive adjustments */
  @media (max-width: 1023px) {
    #mobile-menu {
      max-width: 85vw;
    }
  }

  @media (max-width: 640px) {
    nav {
      padding: 0.625rem 0.75rem !important;
      border-radius: 1rem !important;
      gap: 0.75rem !important;
    }
  }

  @media (max-width: 420px) {
    header > div {
      padding-left: 0.75rem !important;
      padding-right: 0.75rem !important;
    }
    
    nav {
      padding: 0.5rem 0.625rem !important;
      border-radius: 0.875rem !important;
      gap: 0.5rem !important;
    }
  }

  @media (max-width: 375px) {
    header > div {
      padding-left: 0.5rem !important;
      padding-right: 0.5rem !important;
    }
    
    nav {
      padding: 0.5rem !important;
      border-radius: 0.75rem !important;
      gap: 0.5rem !important;
    }
    
    #mobile-menu {
      max-width: 90vw;
    }
  }
</style>
